# recipe_app
A service for the application of custom recipes.

PYTHON LIBRARIES
Список необходимых библиотек python
1) psycopg2 
2) FastApi
3) pydantic



Для работы необходим Python 3, PostgreSQL и uvicorn[standard]
Порядок работы. 
- Установить необходимые библиотеки. Скачать и установить PostgreSQL и uvicorn (это можно сделать на официальных сайтах).
- Открыть файл "data_base.py" и в начале в разделе "config database" указать свои данные для работы с базой.
- Запустить один раз файл "data_base.py" в результате создается база и таблицы.
- Открыть консоль (cmd) и прописать "cd C:parh, где path - к файлу main.py", например, "cd C:\Work\recipe_app" 
- Прописать в консоли "uvicorn main:app --reload" - сервер запущен.


Функции
# Регистрация
Создание аккаунта с уникальным именем, возвращает информацию по созданному аккаунту.
Запрос
/user/add/{nickname}, где nickname - любое имя пользователя
request.get(http://127.0.0.1:8000/user/add/Sajmon)

Успешный ответ
    {"response":[[1670957280,"Sajmon",true,null,"2022-12-14",null]]}
Ошибки
    {"response": f'имя пользователя "{nickname}" уже занято'} - придумайте другое имя

# Авторизация 
Получение всей информации по аккаунту (необходим только id, для выполнения остальных запросов)
/user/login/{nickname}, где nickname - любое имя пользователя
request.get(http://127.0.0.1:8000/user/login/Sajmon)

Успешный ответ
    {"response":{"id":1670946380,"nickname":"Sajmon","status":true,"favorites":null,"date_of_creation":"2022-12-13","date_of_change":null}}
Ошибки
    {"response": f'имя пользователя "{nickname}" не найдено'} - такого никнейма нет в базе 

# Удаление пользователем себя и своих рецептов
Запрос 
/user/remove/nickname={nickname}&login={login}, где nickname - любое имя пользователя, login - айди этого пользователя
request.get(http://127.0.0.1:8000/user/remove/nickname=Sajmon&login=1670946380)

Успешный ответ
    {"response":"Аккаунт \"Sajmon\" удален"}
Ошибки
    {"response": f'Имя пользователя "{nickname}" не найдено'} - такого никнейма нет в базе

# Изменение своего никнейма
Запрос 
/user/edit/nickname={nickname}&login={login}, где nickname - новый ник пользователя, login - айди этого пользователя
request.get(http://127.0.0.1:8000/user/edit/nickname=Sajmon&login=1670946380)

Успешный ответ
    {"response": 'Никнейм изменен'}
Ошибки
    {"response": f'имя пользователя "{nickname}" уже занято'} - придумайте другое имя
    {"response": 'Вы заблокированы'} - ваш аккаунт заблокирован, эта функция не доступна

# Получениe профиля пользователя  
Запрос 
/user/get/nickname={nickname}&login={login}, где nickname - любое имя пользователя, login - айди пользователя, который отправляет запрос
request.get(http://127.0.0.1:8000/user/get/nickname=Sajmon&login=1670946380)

Успешный ответ
    {"response":{"id":1670946380,"nickname":"Sajmon","status":true,"number_of_recipes":7}}
Ошибки
    {"response": 'Вы заблокированы и не можете смотреть других пользователей'} - ваш аккаунт заблокирован, эта функция доступна только для просмотра информации о себе
    {"response": f'Имя пользователя "{nickname}" не найдено'} - такого никнейма нет в базе

# Получение первых 10 пользователей (кроме заблокированных), отсортированных по количеству добавленных рецептов
Запрос 
/user/top
request.get(http://127.0.0.1:8000/user/top)
Успешный ответ
    {"response":[{"id":1670946635,"nickname":"Pepefa","status":true,"number_of_recipes":10},{"id":1670793830,"nickname":"User","status":true,"number_of_recipes":8},{"id":1670946380,"nickname":"Sajmon","status":true,"number_of_recipes":7}]}

# Добавление пользователем рецепта
Запрос 
/recipe/add/ - post запрос, которому необходимо передать json со всей информацией о рецепте

data= {
  "id": int,
  "author": text,
  "date_of_creation": date,
  "date_of_change": date,
  "name": text,
  "type_of_dish": text,
  "description": text,
  "preparation_steps": text,
  "photo": text,
  "likes": int,
  "hashtags": text,
  "status": bool
}

Пример пост запроса с обязательными полями
data= {
"author": 1670946635,
"name": "Мохито",
"type_of_dish": "Напиток",
"description": "Коктейль на основе светлого рома и листьев мяты. ",
"preparation_steps": "2 унции светлого рома; сок из 1 выжатого лайма; 1 чайная ложка сахара; 1—2 унции газированной воды, 5 листьев мяты.",
"photo": "https://upload.wikimedia.org/wikipedia/commons/thumb/8/87/15-09-26-RalfR-WLC-0067.jpg/800px-15-09-26-RalfR-WLC-0067.jpg",
"hashtags": "Мохито, Напиток, Лайм, Ром, Мята",
}
res = requests.post('http://127.0.0.1:8000/recipe/add/', json = data)


Успешный ответ
    {'response': [[1670951289, 1670946635, '2022-12-14', None, 'Мохито', 'Напиток', 'Коктейль на основе светлого рома и листьев мяты. ', '2 унции светлого рома; сок из 1 выжатого лайма; 1 чайная ложка сахара; 1—2 унции газированной воды, 5 листьев мяты.', 'https://upload.wikimedia.org/wikipedia/commons/thumb/8/87/15-09-26-RalfR-WLC-0067.jpg/800px-15-09-26-RalfR-WLC-0067.jpg', 0, 'Мохито, Напиток, Лайм, Ром, Мята', True]]}

Ошибки
    {"response": 'Пользователь заблокирован'} - ваш аккаунт заблокирован, эта функция не доступна

# Получениe рецепта
Запрос 
/recipe/get/{id}&login={login}, где id - айди рецепта, login - айди пользователя, который отправляет запрос
request.get(http://127.0.0.1:8000/recipe/get/1670947345&login=1670946380)

Успешный ответ
    {"response":{"id":1670947345,"author":1670793830,"date_of_creation":"2022-12-13","date_of_change":null,"name":"Чай","type_of_dish":"Напиток","description":"напиток, получаемый варкой, завариванием и/или настаиванием листа чайного куста, который предварительно подготавливается специальным образом.","preparation_steps":"Закипятить воду, залить кипятком чай.","photo":"https://legkovmeste.ru/wp-content/uploads/2019/04/post_5cc16e65ddc17.jpg","likes":0,"hashtags":"Чай, Напиток, Индия, Англия, Китай","status":true}}

Ошибки
    {"response": 'Рецепт не найден'} - такого рецепта нет в базе
    {"response": 'Вы заблокированы и не можете просматривать рецепты'} - ваш аккаунт заблокирован, эта функция не доступна

# Простановка лайка рецепту
Запрос 
/recipe/like/{id}&login={login}, где id - айди рецепта, login - айди пользователя, который отправляет запрос
request.get(http://127.0.0.1:8000/recipe/like/1670947345&login=1670946380)

Успешный ответ
    {"response":"Лайк"}

Ошибки
    {"response": 'Рецепт не найден'} - такого рецепта нет в базе
    {"response": 'Вы заблокированы'} - ваш аккаунт заблокирован, эта функция не доступна

# Удаление своего рецепта
Запрос 
/recipe/remove/{id}&login={login}, где id - айди рецепта, login - айди пользователя, который отправляет запрос
request.get(http://127.0.0.1:8000/recipe/remove/1670947345&login=1670946380)

Успешный ответ
    {"response": 'Рецепт удален'}

Ошибки
    {"response": 'Нельзя удалить чужой рецепт'} - удаляйте только свои рецепты
    {"response": 'Рецепт не найден'} - такого рецепта нет в базе



# Админский API
# Авторизация
Запрос 
/admin/login/{token}, где токен - секретный ключ, указывается в файле config.ini
request.get(http://127.0.0.1:8000/admin/login/your_token)
Успешный ответ
    {"response": 'Успешная авторизация'}

Ошибки
    {"response": 'Неверный токен'} - проверьте совпадает ли ваш токен с токеном в файле config.ini

# Блокировка/разблокировка пользователя
Запрос 
/admin/user_ban/{token}&id_user={id_user}, где токен - секретный ключ, id_user - айди пользователя, которого надо заблокировать/разблокировать
request.get(http://127.0.0.1:8000/admin/user_ban/your_token&id_user=1670946380)

Успешный ответ
    {"response": 'Пользователь заблокирован'}
    {"response": 'Пользователь разблокирован'}

Ошибки
    {"response": 'Неверный токен'} - проверьте совпадает ли ваш токен с токеном в файле config.ini

# Блокировка/разблокировка рецепта
Запрос 
/admin/recipe_ban/{token}&id_recipe={id_recipe}, где токен - секретный ключ, id_recipe - айди рецепта, который надо заблокировать/разблокировать
request.get(http://127.0.0.1:8000/admin/recipe_ban/your_token&id_recipe=1670946380)

Успешный ответ
    {"response": 'Рецепт заблокирован'}
    {"response": 'Рецепт разблокирован'}

Ошибки
    {"response": 'Неверный токен'} - проверьте совпадает ли ваш токен с токеном в файле config.ini




p.s
Реализовал не все функции, которые мог/хотел реализовать. Библиотека FastApi мне не знакома, раньше работал только с Flask. За субботу разобрался с библиотекой, поднял локальную базу у себя, вспомнил как работать с sql и за пару бессонных ночей накидал этот код. Много гуглил, много вспоминал, много узнал нового. Наконец-то освоил git, раньше я с ним знакомился, но не пользовался. 
Нужно было добавить пароль для авторизации и еще куча идей в голове. У меня есть опыт web разработки (Flask + JS) возможно в будущем найду время накидаю страницу для удобного тестирования.